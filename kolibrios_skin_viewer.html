<html>
<!DOCTYPE html>
<html>
  <head>
    <title>KolibriOS skin viewer</title>
  </head>
  <body>
    <input type="file" id="file-input">
    <button onclick="readSkin()">Read Skin</button>
    <script>
        function readSkin() {
            const file = document.getElementById('file-input').files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                let skinBytes = e.target.result;
                let skinData = new DataView(skinBytes);
                let skinObj = new Object();
                // alert(String.fromCharCode(skinData.getUint8(0)));
                skinObj.magic = "";
                for (let i = 0; i < 4; i++)
                skinObj.magic += String.fromCharCode(skinData.getUint8(i));
                // alert(magic);     
                skinObj.version = skinData.getUint32(4, true); // second param - little endian
                
                let params = skinData.getUint32(8, true),
                    buttons = skinData.getUint32(12, true),
                    bitmaps = skinData.getUint32(16, true);

                // alert(params + " " + buttons + " " + bitmaps)

                skinObj.margin = new Object();
                skinObj.margin.right = skinData.getUint16(params + 4, true);
                skinObj.margin.left = skinData.getUint16(params + 6, true);
                skinObj.margin.bottom = skinData.getUint16(params + 8, true);
                skinObj.margin.top = skinData.getUint16(params + 10, true);

                let pad = function(num, len, rdx) {
                    num = num.toString(rdx);
                    while (num.length < len) num = "0" + num;
                    return num;
                }

                H6 = function(x) {return pad(x & 0x00FFFFFF, 6, 16)};

                skinObj.active = new Object();
                skinObj.active.inner = H6(skinData.getUint32(params + 12, true));
                skinObj.active.outer = H6(skinData.getUint32(params + 16, true));
                skinObj.active.frame = H6(skinData.getUint32(params + 20, true));

                skinObj.inactive = new Object();
                skinObj.inactive.inner = H6(skinData.getUint32(params + 24, true));
                skinObj.inactive.outer = H6(skinData.getUint32(params + 28, true));
                skinObj.inactive.frame = H6(skinData.getUint32(params + 32, true));

                skinObj.dtp = new Object();
                skinObj.dtp.size = skinData.getUint32(params + 36, true);
                skinObj.dtp.taskbar = H6(skinData.getUint32(params + 40, true));
                skinObj.dtp.taskbar_text = H6(skinData.getUint32(params + 44, true));
                skinObj.dtp.work_dark = H6(skinData.getUint32(params + 48, true));
                skinObj.dtp.work_light = H6(skinData.getUint32(params + 52, true));
                skinObj.dtp.window_title = H6(skinData.getUint32(params + 56, true));
                skinObj.dtp.work = H6(skinData.getUint32(params + 60, true));
                skinObj.dtp.work_button = H6(skinData.getUint32(params + 64, true));
                skinObj.dtp.work_button_text = H6(skinData.getUint32(params + 68, true));
                skinObj.dtp.work_text = H6(skinData.getUint32(params + 72, true));
                skinObj.dtp.work_graph = H6(skinData.getUint32(params + 76, true));

                skinObj.button = [];
                let pos = buttons;
                while (skinData.getUint32(pos, true) != 0){
                    let btn = new Object();
                    btn.type = skinData.getUint32(pos, true);
                    btn.left = skinData.getInt16(pos + 4, true);
                    btn.top = skinData.getInt16(pos + 6, true);
                    btn.width = skinData.getUint16(pos + 8, true);
                    btn.height = skinData.getUint16(pos + 10, true);
                    skinObj.button.push(btn);
                    pos += 12;
                }


                alert(JSON.stringify(skinObj))
            }
            reader.readAsArrayBuffer(file);
        }
    </script>
  </body>
</html>